```
#!/usr/bin/env python
#########################################################################################
# Title : Recon scanner / recon and enumeration script                                  #
#########################################################################################
import subprocess
import multiprocessing
from multiprocessing import Process, Queue
import os
import time
import logging
from datetime import datetime
import fileinput
import socket
import sys

LOG_FILENAME = "/root/Desktop/auto_nmap_scan/target/nmap_scan.log"
logging.basicConfig(filename=LOG_FILENAME, level=logging.DEBUG)



def nessusScan():
  print "Generating Nessus XML file"
  NESSUS = "nmap -sS -p- -iL '/root/Desktop/auto_nmap_scan/target/target.txt' -oX '/root/Desktop/auto_nmap_scan/target/nessus_nmap.xml'"
  nessus_result = subprocess.check_output(NESSUS, shell=True) 

def ftp_Enum(ip_address,port):
  print "Performing FTP Scan"
  print "IP Address : %s " % (ip_address)
  print ""
  print "Banner Grabbing FTP for IP Address : %s" % (ip_address) 
  FTPSCAN = "nmap -sV -Pn -vv -p %s  --script=ftp-anon,ftp-proftpd-backdoor,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor -oA %s_nmap_ftp.nmap -T4 %s" % (port, ip_address, ip_address)  	
  FTPSCAN = subprocess.check_output(FTPSCAN, shell=True)
  import test


def nmapScan(ip_address):
   ip_address = ip_address.strip()
   print "INFO: Running general TCP/UDP nmap scans for " + ip_address
   serv_dict = {}
   TCPSCAN = "nmap -PN -A -oN '/root/Desktop/auto_nmap_scan/target/%s.nmap' -oX '/root/Desktop/auto_nmap_scan/target/%s_nmap_scan_import.xml' %s"  % (ip_address, ip_address, ip_address)
   #UDPSCAN = "nmap -vv -Pn -A -sC -sU -T 4 --top-ports 200 -oN '/root/Desktop/target/%sU.nmap' -oX '/root/Desktop/target/%sU_nmap_scan_import.xml' %s" % (ip_address, ip_address, ip_address)
   results = subprocess.check_output(TCPSCAN, shell=True) 
   lines = results.split("\n")
   for line in lines:
      ports = []
      line = line.strip()
      if ("tcp" in line) and ("open" in line) and not ("Discovered" in line):
	 while "  " in line: 
            line = line.replace("  ", " ");
         linesplit= line.split(" ")
         service = linesplit[2] # grab the service name
	 port = line.split(" ")[0] # grab the port/proto
         if service in serv_dict:
	    ports = serv_dict[service] # if the service is already in the dict, grab the port list
	 
         ports.append(port) 
	 serv_dict[service] = ports # add service to the dictionary along with the associated port(2)
   
   # go through the service dictionary to call additional targeted enumeration functions 
   for serv in serv_dict: 
      ports = serv_dict[serv]	
      if (serv == "http"):
 	 for port in ports:
	    port = port.split("/")[0]
	    print "HTTP Server found"
	    print port
	    #multProc(httpEnum, ip_address, port)
      elif (serv == "ssl/http") or ("https" in serv):
	 for port in ports:
	    port = port.split("/")[0]
	    print "HTTPS Server found"
	    print "Preparing to do SSL scan"
	    print port
      elif (serv == "ftp"):
	 for port in ports:
	    port = port.split("/")[0]
	    print "FTP Server found"
	    print "Preparing for FTP enumeration"
	    print port
	    ftp_Enum(ip_address,port)
      
   print "INFO: TCP/UDP Nmap scans completed for " + ip_address 
   return


if __name__ == '__main__':
	print "Current Directory: "
	print "We need to load the following file /root/Desktop/auto_nmap_scan/target/target.txt"
	print "Checking file if it exists..."
	#Running and generate the XML file for 
	nessusScan()
	#checkfile('/root/Desktop/auto_nmap_scan/target/target.txt')
	f = open('/root/Desktop/auto_nmap_scan/target/target.txt')
	for scanip in f:
		jobs = []
		p = multiprocessing.Process(target=nmapScan, args=(scanip,))
		jobs.append(p)
		p.start()
	f.close()

```

```
root@kali:~/Desktop/auto_nmap_scan# cat banner.py 
import socket

def banner_grab_http(ip_address,port):
	host = "google.com" #any site name or IP address
	port_1 = int(port)
	addr = (ip_address,port_1)
	s = socket.socket()
	s.connect (addr)
	s.send ("GET / HTTP/1.0\r\nHost: " + host + "\r\n\r\n")
	return s.recv (1024)

def banner_grab(ip_address,port):
        port_1 = int(port)
        addr = (ip_address,port_1)
        s = socket.socket()
        s.connect (addr)
        return s.recv (1024)

```
